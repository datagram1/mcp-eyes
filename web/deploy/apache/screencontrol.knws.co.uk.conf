<VirtualHost *:80>
    ServerName screencontrol.knws.co.uk

    # Security Headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"

    # Proxy to Next.js on port 3002
    ProxyPreserveHost On
    ProxyPass / http://127.0.0.1:3002/
    ProxyPassReverse / http://127.0.0.1:3002/

    # WebSocket support for agent connections at /ws
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/ws(.*)$ ws://127.0.0.1:3002/ws$1 [P,L]

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/screencontrol_error.log
    CustomLog ${APACHE_LOG_DIR}/screencontrol_access.log combined

    # Certbot redirect to HTTPS
    RewriteCond %{SERVER_NAME} =screencontrol.knws.co.uk
    RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>
